"use strict";const TaskSettings={MINLENGTH:1,MAXLENGTH:75,COUNTERSUPDATEINTERVAL:1e3};let tasksArray=[];const bodyElem=document.querySelector(".body"),dateElem=document.querySelector(".date"),timeElem=document.querySelector(".time"),tasksBodyElem=document.querySelector(".tasks-body"),addBlock=document.querySelector(".add-block"),addTaskInput=document.querySelector(".add-block-input"),addTaskBtn=document.querySelector(".add-task-btn"),taskContainerElem=document.querySelector(".tasks-container"),taskTextElem=document.querySelector(".task-text"),settingsIconBtn=document.querySelector(".settings-icon"),settingsContainer=document.querySelector(".settings-container"),closeDateContBtn=document.querySelector(".close-settings-icon"),progress=document.querySelector(".preloader-progress"),preloader=document.querySelector(".preloader"),switcher=document.querySelector(".switch__input"),themeTextEl=document.querySelector(".switch__sr"),radioButtons=document.querySelectorAll(".label-radio"),modalConfBtn=document.querySelectorAll(".modal_confirm-btn");let textHeaderSetDeadline="Set a deadline (optional)",textBtnSetDeadline="Set",textDoNotSetDeadline="Do not set",selectedLanguage="en";getFromLocalStorage(),areThereTasks(),window.onload=function(){setTimeout(function(){preloader.style.display="none"},1e3)};var granimInstance=new Granim({element:"#canvas-basic",direction:"diagonal",isPausedWhenNotInView:!0,stateTransitionSpeed:3500,states:{"default-state":{gradients:[["#5A72E3","#1691bc"],["#055aa0","#055aa0"],["#b965e4","#402495"]]}}});let themeState=localStorage.getItem("theme");"dark-theme"===themeState?(bodyElem.classList.add("dark-theme"),"ru"===selectedLanguage?themeTextEl.textContent="Темная":themeTextEl.textContent="Dark",switcher.checked=!0):(bodyElem.classList.remove("dark-theme"),"ru"===selectedLanguage?themeTextEl.textContent="Светлая":themeTextEl.textContent="Light",switcher.checked=!1),switcher.addEventListener("change",function(){switcher.checked?(bodyElem.classList.add("dark-theme"),"ru"===selectedLanguage?themeTextEl.textContent="Темная":themeTextEl.textContent="Dark",themeState="dark-theme",localStorage.setItem("theme","dark-theme")):(bodyElem.classList.remove("dark-theme"),"ru"===selectedLanguage?themeTextEl.textContent="Светлая":themeTextEl.textContent="Light",themeState="light-theme",localStorage.setItem("theme","light-theme"))});const savedLang=localStorage.getItem("lang");function changeLanguage(){"ru"===selectedLanguage?("dark-theme"===themeState?themeTextEl.textContent="Темная":themeTextEl.textContent="Светлая",addTaskInput.setAttribute("placeholder","Добавить задачу"),textHeaderSetDeadline="Установить срок выполнения",textBtnSetDeadline="Установить",textDoNotSetDeadline="Не устанавливать",tasksBodyElem.classList.contains("tasks-body_empty")&&(tasksBodyElem.classList.add("tasks-body_empty-rus"),tasksBodyElem.classList.remove("tasks-body_empty"))):("dark-theme"===themeState?themeTextEl.textContent="Dark":themeTextEl.textContent="Light",addTaskInput.setAttribute("placeholder","Add new task"),textHeaderSetDeadline="Set a deadline (optional)",textBtnSetDeadline="Set",textDoNotSetDeadline="Do not set",tasksBodyElem.classList.contains("tasks-body_empty-rus")&&(tasksBodyElem.classList.remove("tasks-body_empty-rus"),tasksBodyElem.classList.add("tasks-body_empty"))),fetch("localization.json").then(e=>e.json()).then(a=>{const s=selectedLanguage;document.querySelectorAll("[data-translation-key]").forEach(e=>{var t=e.dataset.translationKey;e.textContent=a[s][t]})}).catch(e=>{console.error("Ошибка загрузки JSON файла:",e)})}function createNewTask(e){if(!(0<e.length&&e.length<TaskSettings.MAXLENGTH))return e.length>TaskSettings.MAXLENGTH?"ru"===selectedLanguage?(addBlock.classList.add("alert-max-length_rus"),void addBlock.classList.remove("alert-min-length_rus")):(addBlock.classList.add("alert-max-length"),void addBlock.classList.remove("alert-min-length")):"ru"===selectedLanguage?(addBlock.classList.add("alert-min-length_rus"),void addBlock.classList.remove("alert-max-length_rus")):(addBlock.classList.add("alert-min-length"),void addBlock.classList.remove("alert-max-length"));{addBlock.classList.remove("alert-max-length"),addBlock.classList.remove("alert-max-length_rus"),addBlock.classList.remove("alert-min-length"),addBlock.classList.remove("alert-min-length_rus");const a=document.createElement("div"),s=(a.className="task",a.innerHTML=`<label class="custom-checkbox">
    <input class="task-checkbox" type="checkbox">
    <span class="checkmark"></span>
    </label>
    <div class="task-text-wrapper"><div class="task-text"></div></div>
    <button class="task-delete-btn"></button>
    <button class="task-edit-btn"></button>`,40<e.length&&a.classList.add("task_dots"),validateText(e)),n=(a.setAttribute("title",e),a.querySelector(".task-text").textContent=s,a.querySelector(".task-text").classList.add("trim-text"),document.createElement("div"));n.classList.add("modal-container"),n.innerHTML=`<div class="modal">
      <div class="modal-header">
      ${textHeaderSetDeadline}</div>
      <div class="date-time-input-wrapper"><input id="date-time-picker" type="datetime-local" name="date-time-picker"></div>
      <button class="modal_confirm-btn">${textBtnSetDeadline}</button>
      <button class="modal_skip-btn">${textDoNotSetDeadline}</button>
    </div>`,bodyElem.appendChild(n);var e=document.querySelector(".modal_confirm-btn"),t=document.querySelector(".modal_skip-btn");const o=document.querySelector("#date-time-picker");e.onclick=function(){var e;""===o.value?"ru"===selectedLanguage?n.querySelector(".date-time-input-wrapper").classList.add("date-input-alert_rus"):n.querySelector(".date-time-input-wrapper").classList.add("date-input-alert"):(e=createCountdown(o.value),a.appendChild(e),taskContainerElem.appendChild(a),e=e.dataset.time,tasksArray.push({text:s,status:"unfinished",time:e}),addToLocalStorage(tasksArray),areThereTasks(),document.querySelector(".add-block-input").value="",document.querySelector(".modal-container").remove())},t.onclick=function(){taskContainerElem.appendChild(a),tasksArray.push({text:s,status:"unfinished"}),addToLocalStorage(tasksArray),areThereTasks(),document.querySelector(".add-block-input").value="",document.querySelector(".modal-container").remove()}}}function createCountdown(e){var t,a,s,e=new Date(e),n=new Date,n=e.getTime()-n.getTime(),o=document.createElement("div");return o.className="countdown",n<=0?(o.innerHTML="Time is up :(",o.style.color="rgb(192, 2, 2)",o.setAttribute("data-time",e.getTime())):(n=Math.floor(n/1e3),t=Math.floor(n/60),a=Math.floor(t/60),s=Math.floor(a/24),a%=24,t%=60,n%=60,o.setAttribute("data-time",e.getTime()),"ru"===selectedLanguage?o.innerHTML=`Осталось ${s} д ${a} ч ${t} мин`:o.innerHTML=s+`d ${a}h ${t}min left`),o}function updateCountdown(){var e,t=document.querySelectorAll(".countdown"),a=new Date;for(e of t){var s,n,o,r=e.dataset.time-a.getTime();r<=6e4?("ru"===selectedLanguage?e.innerHTML="Время вышло :(":e.innerHTML="Time is up :(",e.classList.add("red-color")):(r=Math.floor(r/1e3),s=Math.floor(r/60),n=Math.floor(s/60),o=Math.floor(n/24),n%=24,s%=60,r%=60,"ru"===selectedLanguage?e.innerHTML=`Осталось ${o} д ${n} ч ${s} мин`:e.innerHTML=o+`d ${n}h ${s}min left`)}}function validateText(e){return e}function pushTaskToArray(e){e.push(tasksArray)}function addToLocalStorage(e){e=JSON.stringify(e);localStorage.setItem("tasksArray",e)}function getFromLocalStorage(){var e=localStorage.getItem("tasksArray");return null!==e&&(tasksArray=JSON.parse(e),areThereTasks(),tasksArray.forEach(function(e,t){var a=document.createElement("div"),s=(a.className="task",a.innerHTML=`<label class="custom-checkbox">
      <input class="task-checkbox" type="checkbox">
      <span class="checkmark"></span>
      </label>
      <div class="task-text-wrapper"><div class="task-text"></div></div>
      <button class="task-delete-btn"></button>
      <button class="task-edit-btn"></button>`,validateText(e.text)),n=(e.status,a.querySelector(".task-checkbox")),o=a.querySelector(".task-text");40<s.length?a.classList.add("task_dots"):a.classList.remove("task_dots"),o.textContent=s,o.classList.add("trim-text"),"done"===e.status&&(n.checked=!0,o.style.color="green",o.style.textDecorationLine="line-through"),void 0!==e.time&&((s=document.createElement("div")).className="countdown",s.setAttribute("data-time",e.time),a.appendChild(s)),taskContainerElem.appendChild(a)})),tasksArray}function areThereTasks(){0===tasksArray.length?"ru"===selectedLanguage?tasksBodyElem.classList.add("tasks-body_empty-rus"):tasksBodyElem.classList.add("tasks-body_empty"):(tasksBodyElem.classList.remove("tasks-body_empty"),tasksBodyElem.classList.remove("tasks-body_empty-rus"))}"ru"===savedLang&&(selectedLanguage="ru",changeLanguage()),radioButtons.forEach(e=>{e.addEventListener("click",()=>{selectedLanguage=e.value,localStorage.setItem("lang",selectedLanguage),changeLanguage()})}),settingsIconBtn.onclick=function(){settingsContainer.classList.add("settings-container_opened")},document.addEventListener("click",function(e){e.target.classList.contains("settings-container")||e.target.classList.contains("settings-icon")||settingsContainer.classList.remove("settings-container_opened")}),addTaskBtn.onclick=function(){createNewTask(addTaskInput.value)},setInterval(updateCountdown,TaskSettings.COUNTERSUPDATEINTERVAL),taskContainerElem.onclick=function(e){document.querySelectorAll(".task");if(e.target.classList.contains("checkmark")||e.target.classList.contains("task-text")){e.preventDefault();var t=e.target.closest(".task"),a=t.querySelector(".task-checkbox");const s=t.querySelector(".task-text");!0===a.checked?(a.checked=!1,s.style.color="#333",s.style.textDecorationLine="none"):(a.checked=!0,s.style.color="green",s.style.textDecorationLine="line-through");t=tasksArray.find(e=>e.text===s.textContent);"unfinished"===t.status?t.status="done":t.status="unfinished",addToLocalStorage(tasksArray)}if(e.target.classList.contains("task-edit-btn")){const n=e.target.parentNode,o=n.querySelector(".task-text"),r=n.querySelector(".task-edit-btn");if(null==n.querySelector(".edit-input")){a=document.createElement("textarea"),t=(a.className="edit-input",a.setAttribute("rows","1"),a.setAttribute("cols","30"),a.value=o.textContent,n.appendChild(a),document.createElement("button"));t.className="task-confirm-btn",r.style.display="none",n.appendChild(t);const l=n.querySelector(".task-confirm-btn"),d=n.querySelector(".edit-input");a.addEventListener("keydown",function(e){"Enter"===e.key&&(e=tasksArray.find(e=>e.text===o.textContent),o.setAttribute("title",this.value),40<this.value.length?n.classList.add("task_dots"):n.classList.remove("task_dots"),o.textContent=this.value,e.text=d.value,n.querySelector(".edit-input").remove(),r.style.display="block",l.remove(),addToLocalStorage(tasksArray))}),l.onclick=function(){var e=tasksArray.find(e=>e.text===o.textContent);o.setAttribute("title",d.value),40<d.value.length?n.classList.add("task_dots"):n.classList.remove("task_dots"),o.textContent=d.value,e.text=d.value,n.querySelector(".edit-input").remove(),r.style.display="block",l.remove(),addToLocalStorage(tasksArray)}}}if(e.target.classList.contains("task-delete-btn")){const c=e.target.parentNode,i=(c.classList.add("red-bg"),c.querySelector(".task-text").textContent);addToLocalStorage(tasksArray=tasksArray.filter(e=>e.text!==i)),areThereTasks(),setTimeout(()=>c.remove(),100)}};